services:
  nginx:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "${HTTP_PORT:-8080}:80"
    environment:
      APP_ENV: production
      APP_DEBUG: "false"
      APP_URL: https://planin.43-157-213-47.sslip.io
      DB_CONNECTION: pgsql
      DB_HOST: ${DB_HOST:-43.157.213.47}
      DB_PORT: ${DB_PORT:-5432}
      DB_DATABASE: ${DB_DATABASE:-filament}
      DB_USERNAME: ${DB_USERNAME:-filament}
      DB_PASSWORD: ${DB_PASSWORD:-change-me}
      SESSION_DRIVER: database
      CACHE_STORE: database
      QUEUE_CONNECTION: database
      TZ: ${TZ:-UTC}
    volumes:
      - app-storage:/var/www/html/storage
      - app-bootstrap-cache:/var/www/html/bootstrap/cache
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://127.0.0.1/ || exit 1"]
      interval: 30s
      timeout: 5s
      retries: 5
    restart: unless-stopped

volumes:
  app-storage:
  app-bootstrap-cache:
